<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Waifu Gallery — SFW / NSFW (Android-style)</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#9aa4b2; --accent:#7dd3fc; --glass: rgba(255,255,255,0.04);
      --gap:8px; --radius:12px; --left-width:84px;
      color-scheme: dark;
    }
    *{box-sizing:border-box}
    html,body{height:100%; margin:0; font-family:Roboto,system-ui,-apple-system,Segoe UI,Helvetica,Arial,sans-serif; background:var(--bg); color:#e6eef6}

    /* Header */
    header{position:sticky;top:0;z-index:40;display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid rgba(255,255,255,0.06);backdrop-filter: blur(8px);background:rgba(8,12,20,0.9)}
    .brand{font-weight:700;font-size:16px}
    .right-controls{display:flex;gap:8px;align-items:center}
    .btn{background:var(--glass);border:none;padding:8px 10px;border-radius:10px;color:var(--muted);cursor:pointer;font-weight:600;font-size:13px}
    select.api{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);padding:6px 8px;border-radius:8px}

    /* Left SFW vertical strip */
    .left-sfw{position:fixed;left:0;top:56px;bottom:0;width:var(--left-width);background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-right:1px solid rgba(255,255,255,0.03);padding:10px 6px;display:flex;flex-direction:column;gap:8px;align-items:center}
    .left-sfw .sbtn{width:64px;height:64px;border-radius:12px;background:var(--card);display:flex;align-items:center;justify-content:center;color:var(--muted);font-weight:700;border:1px solid rgba(255,255,255,0.02);cursor:pointer;text-align:center;padding:6px}
    .left-sfw .sbtn.active{background:linear-gradient(90deg,var(--accent),#60a5fa);color:#071830}
    .left-sfw .label{font-size:11px;color:var(--muted);writing-mode:vertical-rl;transform:rotate(180deg);margin-top:8px}

    /* Side menu (hamburger) */
    .menu-btn{background:none;border:none;color:var(--muted);font-size:20px;cursor:pointer}
    .side-menu{position:fixed;top:0;left:-260px;width:240px;height:100%;background:var(--card);z-index:100;transition:left .28s ease;padding:20px 14px;display:flex;flex-direction:column;gap:12px}
    .side-menu.open{left:0}
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.45);z-index:90;display:none}
    .overlay.show{display:block}

    /* Main content area shifted right to leave space for left-sfw */
    .content{margin-left:calc(var(--left-width) + 12px);padding:12px}
    .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}

    .gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:var(--gap);margin-top:12px}
    .card{background:var(--card);border-radius:12px;overflow:hidden;position:relative;min-height:160px}
    .thumb{width:100%;height:100%;display:block;background-size:cover;background-position:center center}
    .meta{position:absolute;left:6px;bottom:6px;right:6px;padding:6px;border-radius:8px;background:rgba(0,0,0,0.45);display:flex;justify-content:space-between;align-items:center}
    .meta .title{font-weight:600;font-size:12px}
    .meta .sfw{font-size:11px;color:var(--muted)}

    .lightbox{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(3,6,12,0.9);z-index:150;padding:16px}
    .lbcard{width:100%;max-width:560px;max-height:94vh;background:var(--card);border-radius:12px;overflow:hidden;display:flex;flex-direction:column}
    .lbimg{flex:1;background-size:contain;background-repeat:no-repeat;background-position:center;width:100%}
    .lbfoot{padding:10px 12px;display:flex;justify-content:space-between;align-items:center;font-size:14px}

    footer{padding:14px;color:var(--muted);text-align:center;font-size:13px}

    @media (max-width:720px){
      .left-sfw{display:none}
      .content{margin-left:0;padding:12px}
      .gallery{grid-template-columns:repeat(2,1fr)}
    }
  </style>
</head>
<body>
  <header>
    <div style="display:flex;align-items:center;gap:10px">
      <button id="menuBtn" class="menu-btn">☰</button>
      <div class="brand">WAIFU.GALLERY</div>
    </div>

    <div class="right-controls">
      <button onclick="window.location.href='video.html'" class="btn">hentai</button>
      <label style="font-size:13px;color:var(--muted);">API</label>
      <select id="apiSelect" class="api">
        <option value="waifu.pics">waifu.pics</option>
        <option value="waifu.im">waifu.im</option>
      </select>
      <button id="toggleNsfw" class="btn">NSFW: OFF</button>
    </div>
  </header>

  <!-- Left vertical SFW menu (always available on wider screens) -->
  <aside class="left-sfw" id="leftSfw">
    <!-- buttons generated by JS -->
    <div class="label">SFW</div>
  </aside>

  <!-- Slide-out side menu -->
  <nav class="side-menu" id="sideMenu">
    <h3 style="margin:0;color:#fff">Kategori Cepat</h3>
    <a href="#" data-tag="waifu">Waifu</a>
    <a href="#" data-tag="neko">Neko</a>
    <a href="#" data-tag="hug">Hug</a>
    <a href="#" data-tag="cuddle">Cuddle</a>
    <a href="#" data-tag="kiss">Kiss</a>
    <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03)">
    <div style="font-size:13px;color:var(--muted)">Lainnya</div>
    <a href="#" data-tag="trap">Trap</a>
    <a href="#" data-tag="blowjob">Blowjob</a>
  </nav>
  <div class="overlay" id="overlay"></div>

  <main class="content">
    <div class="controls">
      <button id="refreshBtn" class="btn">Refresh</button>
      <button id="loadMoreBtn" class="btn">Load More</button>
    </div>

    <section id="images">
      <div class="gallery" id="gallery" role="list"></div>
    </section>
  </main>

  <div class="lightbox" id="lightbox" role="dialog" aria-hidden="true">
    <div class="lbcard">
      <div class="lbimg" id="lbimg"></div>
      <div class="lbfoot">
        <div id="lbmeta">&nbsp;</div>
        <button id="closeLb" class="btn">Tutup</button>
      </div>
    </div>
  </div>

  <footer>
    Sekarang ada panel SFW di kiri, plus pilihan API (waifu.pics / waifu.im). Hosting: langsung buka file ini di web server.
  </footer>

  <script>
    // Config & state
    let nsfw = false
    let limit = 12
    let currentTag = 'waifu'
    let apiSource = 'waifu.pics' // or 'waifu.im'

    const gallery = document.getElementById('gallery')
    const leftSfw = document.getElementById('leftSfw')
    const apiSelect = document.getElementById('apiSelect')

    const sfwTags = ['waifu','neko','hug','cuddle','kiss','smile','wave','pat','blush','happy']

    // Helpers to build API requests for both providers
    function waifuPicsUrl(tag){
      return `https://api.waifu.pics/${nsfw? 'nsfw':'sfw'}/${tag}`
    }

    function waifuImUrl(tag){
      // use search endpoint; request 'limit' items
      // params: included_tags (repeatable), is_nsfw, limit
      const params = new URLSearchParams()
      params.append('included_tags', tag)
      params.append('limit', limit)
      params.append('is_nsfw', nsfw ? 'true' : 'false')
      return `https://api.waifu.im/search?${params.toString()}`
    }

    async function fetchFromWaifuPics(tag){
      // waifu.pics returns single url per request; call multiple times to fill batch
      try{
        const res = await fetch(waifuPicsUrl(tag))
        if(!res.ok) throw new Error('fetch failed')
        const data = await res.json()
        return [{ url: data.url, tag, sfw: !nsfw }]
      }catch(e){
        return []
      }
    }

    async function fetchFromWaifuIm(tag){
      try{
        const res = await fetch(waifuImUrl(tag))
        if(!res.ok) throw new Error('fetch failed')
        const data = await res.json()
        // docs show results as data.images array
        const arr = data.images || data || []
        // map to consistent format
        return arr.slice(0, limit).map(it=>({ url: it.url || it.original || it.preview_url, tag, sfw: it.is_nsfw ? false : true }))
      }catch(e){
        return []
      }
    }

    async function fetchBatch(tag){
      if(apiSource === 'waifu.pics'){
        // waifu.pics gives one image per request; perform 'limit' requests concurrently
        const promises = Array.from({length:limit}).map(()=>fetchFromWaifuPics(tag))
        const results = await Promise.all(promises)
        return results.flat()
      }else{
        return await fetchFromWaifuIm(tag)
      }
    }

    // UI builders
    function createCard(item){
      const el = document.createElement('div')
      el.className = 'card'
      const thumb = document.createElement('a')
      thumb.href = '#'
      thumb.className = 'thumb'
      thumb.style.backgroundImage = `url(${item.url})`
      thumb.addEventListener('click',(e)=>{e.preventDefault();openLightbox(item)})

      const meta = document.createElement('div')
      meta.className = 'meta'
      meta.innerHTML = `<div class="title">${item.tag}</div><div class="sfw">${item.sfw?'SFW':'NSFW'}</div>`

      el.appendChild(thumb)
      el.appendChild(meta)
      return el
    }

    function resetGallery(){ gallery.innerHTML = '' }

    async function loadBatch(){
      const imgs = await fetchBatch(currentTag)
      if(imgs.length === 0) return
      for(const it of imgs){
        const c = createCard(it)
        gallery.appendChild(c)
      }
    }

    // Left SFW panel build
    function initLeftSfw(){
      leftSfw.innerHTML = ''
      sfwTags.forEach(t=>{
        const btn = document.createElement('div')
        btn.className = 'sbtn' + (t===currentTag? ' active':'')
        btn.textContent = t.length>6 ? t.slice(0,6)+'…' : t
        btn.title = t
        btn.addEventListener('click',()=>{
          document.querySelectorAll('.sbtn').forEach(x=>x.classList.remove('active'))
          btn.classList.add('active')
          currentTag = t
          resetGallery(); loadBatch()
        })
        leftSfw.appendChild(btn)
      })
      const label = document.createElement('div')
      label.className = 'label'
      label.textContent = 'SFW'
      leftSfw.appendChild(label)
    }

    // Side menu behaviour
    const menuBtn = document.getElementById('menuBtn')
    const sideMenu = document.getElementById('sideMenu')
    const overlay = document.getElementById('overlay')
    menuBtn.addEventListener('click',()=>{ sideMenu.classList.add('open'); overlay.classList.add('show') })
    overlay.addEventListener('click',()=>{ sideMenu.classList.remove('open'); overlay.classList.remove('show') })
    document.querySelectorAll('#sideMenu a').forEach(a=>{
      a.addEventListener('click',e=>{
        e.preventDefault(); currentTag = a.getAttribute('data-tag'); sideMenu.classList.remove('open'); overlay.classList.remove('show'); resetGallery(); loadBatch();
      })
    })

    // Lightbox
    const lightbox = document.getElementById('lightbox')
    const lbimg = document.getElementById('lbimg')
    const lbmeta = document.getElementById('lbmeta')
    document.getElementById('closeLb').addEventListener('click',closeLightbox)
    lightbox.addEventListener('click',(e)=>{ if(e.target===lightbox) closeLightbox() })
    function openLightbox(item){ lbimg.style.backgroundImage = `url(${item.url})`; lbmeta.textContent = `${item.tag} • ${item.sfw?'SFW':'NSFW'}`; lightbox.style.display = 'flex'; lightbox.setAttribute('aria-hidden','false') }
    function closeLightbox(){ lightbox.style.display = 'none'; lightbox.setAttribute('aria-hidden','true') }

    // Controls
    document.getElementById('refreshBtn').addEventListener('click',()=>{ resetGallery(); loadBatch() })
    document.getElementById('loadMoreBtn').addEventListener('click',()=>{ loadBatch() })
    document.getElementById('toggleNsfw').addEventListener('click',()=>{
      if(!nsfw){ if(!confirm('Aktifkan NSFW? Konten mungkin tidak sesuai untuk semua orang.')) return }
      nsfw = !nsfw
      document.getElementById('toggleNsfw').textContent = nsfw? 'NSFW: ON':'NSFW: OFF'
      resetGallery(); loadBatch()
    })

    apiSelect.addEventListener('change',(e)=>{
      apiSource = e.target.value
      // clear & reload using new API
      resetGallery(); loadBatch()
    })

    // init
    initLeftSfw()
    loadBatch()
  </script>
</body>
</html>
